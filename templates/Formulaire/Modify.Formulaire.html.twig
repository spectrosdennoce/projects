{% extends "Header-Footer.html.twig" %}
{% block javascripts %}
<script>
$(document).ready(function(){
    $("#New_line").click(function(){
        $.ajax({
        url: "/Formulaire/Create_Ligne/",
        type:"POST",
        data:{
        id: {{ formulaire.getID() }},
        },
        success:function(response) {
            console.log("OK");
            $( "#ul-line" ).html(response);
            sendscreen();
        },
        error:function(){
            console.log("KO");
        }
        });
    });
    $("#Delete_Forms").click(function(){
        $.ajax({
        url: "/Formulaire/Delete_Forms/",
        type:"POST",
        data:{
        Id_Forms: {{ formulaire.getID() }},
        },
        success:function(response) {
            console.log("OK"); 	 
            $(location).attr('href', '/') 
        },
        error:function(){
            console.log("KO");
        }
        });
    });
    $("#Restore_Forms").click(function(){
        $.ajax({
        url: "/Formulaire/Restore_Forms/",
        type:"POST",
        data:{
        id: {{ formulaire.getID() }},
        },
        success:function(response) {
            console.log("OK");
            $("body").html(response);
        },
        error:function(){
            console.log("KO");
        }
        });
    });
    $('body').on('click', '#Delete', function(){
        $.ajax({
            url: "/Formulaire/Delete_Ligne/",
            type:"POST",
            data:{
            id: $(this).attr("data-id"),
            },
            success:function(response) {
                console.log("OK"); 	  
                $( "#ul-line" ).html(response);
                sendscreen();
            },
            error:function(){
                console.log("KO");
            }
        });
    });
    $('body').on('click', '#Clone', function(){
        $.ajax({
            url: "/Formulaire/Clone_Ligne/",
            type:"POST",
            data:{
            Id_Forms: {{ formulaire.getID() }},
            id: $(this).attr("data-id"),
            },
            success:function(response) {
                console.log("OK"); 	  
                $( "#ul-line" ).html(response);
                sendscreen();
            },
            error:function(){
                console.log("KO");
            }
        });
    });
    $('body').on('click', '#Delete_Inline', function(){
        $.ajax({
            url: "/Formulaire/Delete_InLine/",
            type:"POST",
            data:{
            Id_Forms: {{ formulaire.getID() }},
            id: $(this).attr("data-id"),
            },
            success:function(response) {
                console.log("OK"); 	  
                $( "#ul-line" ).html(response);
                sendscreen();
            },
            error:function(){
                console.log("KO");
            }
        });
    });
    $('body').on('change', 'select', function(){
        $.ajax({
            url: "/Formulaire/Change_Ligne/",
            type:"POST",
            data:{
                Id_Forms: {{ formulaire.getID() }},
                Id : $(this).attr("data-id"),
                Name : $(this).attr("name"),
                Value : $(this).find(':selected').val()
            },
            success:function(response) {
                console.log("OK"); 	  
                $( "#ul-line" ).html(response);
                sendscreen();
            },
            error:function(){
                console.log("KO");
            }
        });
    });
    $('body').on('focusout', '.Create_inligne', function(){
        $.ajax({
            url: "/Formulaire/Create_InLigne/",
            type:"POST",
            data:{
                Id_Forms: {{ formulaire.getID() }},
                Id_Ligne: $(this).attr("data-id"),
                Value : $(this).val()
            },
            success:function(response) {
                console.log("OK"); 	  
                $( "#ul-line" ).html(response);
                sendscreen();
            },
            error:function(){
                console.log("KO");
            }
        });
    });
    $('body').on('focusout', '.change_ligne , input[type=date]', function(){
        $.post( "/Formulaire/Change_Ligne/", { Id_Forms: {{ formulaire.getID() }},Id: $(this).attr("data-id"), Name : $(this).attr("name"), Value : $(this).val() } );
    });
    $('body').on('change', 'input[type=checkbox]', function(){
        $.post( "/Formulaire/Change_Ligne/", { Id_Forms: {{ formulaire.getID() }},Id: $(this).attr("data-id"), Name : $(this).attr("name"), Value : $(this).prop('checked') } );
    });
    $('body').on('change', '.change_inligne', function(){
        $.post( "/Formulaire/Change_InLigne/", { Id_Forms: {{ formulaire.getID() }},Id: $(this).attr("data-id"), Value : $(this).val() } );
    });
    $('body').on('change', '.change_Forms', function(){
        $.post( "/Formulaire/Change_Forms/", { Id_Forms: {{ formulaire.getID() }}, Value : $(this).val() } );
    });
    function sendscreen(){
        html2canvas(document.querySelector(".container"),{
            dpi: 144}
            ).then(canvas => {
            $.post( "/Formulaire/Save_Img/", { T_Slug: "{{app.request.get('T_Slug')}}",base64: canvas.toDataURL() } );
        });
    }
    sendscreen();
});
</script>
{% endblock %}
{% block body %}
    <div class="container">
        <div class="card">
            <div class="card-header">
                Option
            </div>
            <ul class="list-group">
                <li class="list-group-item">
                    <div class="form-group">
                        <p>Titre du Formulaire</p>
                        <input name="T_Titre" value="{{ formulaire.getTitre() }}" type="text" class="form-control change_Forms" placeholder="titre" aria-label="Titre"></input>
                    </div>
                    <div class="container mb-3">
                        <div class="row">
                            <div class="form-group col-sm-6 d-flex justify-content-center">
                                <button class='btn btn-primary' id="Add_Utils_diffusion">Ajouter Utilisateur</button><!-- a reflechire pour integration -->
                            </div>
                            <div class="form-group col-sm-6 d-flex justify-content-center">
                                <button class='btn btn-primary' id="Add_Groups_diffusion">Ajouter Groupe</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-sm-11">
                            <select class="custom-select"><!-- a faire controller -->
                                <option>choose ur god!</option>
                                {% if utils.getAdmin == 1 %}
                                    {% for group in AllGroups %}
                                        <option>{{ group.getTitre() }}</option>
                                    {% endfor %}
                                {% else %}
                                    {% for groups in utils.getGroups() %}
                                        {% if groups.getDelegue == 1 %}
                                            {% set group = groups.getIdGroups() %}
                                            <option>{{ group.getTitre() }}</option>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </select>
                            </div>
                            <div class="form-group col-sm-1">
                                <button id="Delete_Groupe" class='btn btn-secondary' data-id=""><i class="fa fa-trash"style="color:White" aria-hidden="true"></i></button><!-- a faire controller -->
                            </div>
                        </div>
                    </div>
                </li>
                <li class="list-group-item">
                    <div class="form-group d-flex justify-content-end">
                        {% if formulaire.getVisible() == 1 %} 
                            <button class='btn btn-danger' id="Delete_Forms">Suprimer Formulaire</button>
                        {% else %}
                            <button class='btn btn-success' id="Restore_Forms">Restorer Formulaire</button>
                        {% endif %}
                    </div>
                </li>
            </ul>
        </div>
        <div class="card">
            <div class="card-header">
                Formulaire
            </div>
            {{ include('Formulaire/ligne.html.twig') }}
            <button class='btn btn-primary' id="New_line">Ajouter ligne</button>
        </div>
{% endblock %}